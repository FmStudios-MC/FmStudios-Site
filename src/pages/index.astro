---
import Layout from '../layouts/Layout.astro';
import Icon from '../components/Icon.astro';
import ScrollReveal from '../components/ScrollReveal.astro';
import SocialBar from '../components/SocialBar.astro';
import ProjectCard from '../components/ProjectCard.astro';
import Modal from '../components/Modal.astro';
import LightboxModal from '../components/LightboxModal.astro';
import { projects } from '../data/projects';

// Featured: first 3 projects
const featured = projects.slice(0, 3);
---

<Layout title="FabiMvurice Interactive - Minecraft Projects">
  <!-- Hero -->
  <section class="max-w-7xl mx-auto px-6 pt-16 pb-12 relative">
    <div class="hero-glow" aria-hidden="true"></div>
    <ScrollReveal>
      <div class="max-w-3xl relative z-10">
        <p class="text-sm font-semibold uppercase tracking-widest mb-4" style="color: var(--accent);">
          Minecraft Modpacks &amp; More
        </p>
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-black leading-tight mb-6">
          <span class="gradient-text hero-text-reveal">FabiMvurice</span>
          <br />
          <span style="color: var(--text-primary);">Interactive</span>
        </h1>
        <p class="text-lg mb-8 max-w-2xl" style="color: var(--text-muted);">
          Creating amazing Minecraft modpacks, mods, and resource packs. From Create-based tech packs to Vanilla+ experiences.
        </p>
        <div class="flex flex-wrap gap-4">
          <a href="/projects" class="btn-primary inline-flex items-center gap-2">
            <Icon name="package" size={18} />
            View Projects
          </a>
          <a href="/news" class="btn-outline inline-flex items-center gap-2">
            <Icon name="chevron-right" size={18} />
            Latest News
          </a>
        </div>
      </div>
    </ScrollReveal>
  </section>

  <!-- Featured Projects -->
  <section class="max-w-7xl mx-auto px-6 pb-12">
    <ScrollReveal>
      <div class="flex items-center justify-between mb-8">
        <div>
          <p class="text-xs font-semibold uppercase tracking-widest mb-1" style="color: var(--accent);">Featured</p>
          <h2 class="text-2xl font-bold" style="color: var(--text-primary);">Projects</h2>
        </div>
        <a href="/projects" class="text-sm font-semibold inline-flex items-center gap-1" style="color: var(--accent);">
          View all <Icon name="chevron-right" size={16} />
        </a>
      </div>
    </ScrollReveal>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {featured.map((project, i) => (
        <ScrollReveal delay={i * 100}>
          <ProjectCard project={project} />
        </ScrollReveal>
      ))}
    </div>
  </section>

  <!-- About Blurb -->
  <section class="max-w-7xl mx-auto px-6 pb-12">
    <ScrollReveal>
      <div class="card p-8">
        <div class="max-w-2xl">
          <p class="text-xs font-semibold uppercase tracking-widest mb-2" style="color: var(--accent);">About</p>
          <h2 class="text-2xl font-bold mb-4" style="color: var(--text-primary);">Who We Are</h2>
          <p class="leading-relaxed" style="color: var(--text-muted);">
            FabiMvurice Interactive is a small creative studio focused on Minecraft content creation. We build modpacks that combine the best community mods into polished, performant experiences. Whether you're into Create-based automation, Vanilla+ gameplay, or resource packs, we've got something for you.
          </p>
        </div>
      </div>
    </ScrollReveal>
  </section>

  <!-- Social Links -->
  <section class="max-w-7xl mx-auto px-6 pb-16">
    <ScrollReveal>
      <div class="text-center mb-6">
        <p class="text-xs font-semibold uppercase tracking-widest mb-1" style="color: var(--accent);">Connect</p>
        <h2 class="text-2xl font-bold" style="color: var(--text-primary);">Join the Community</h2>
      </div>
      <SocialBar />
    </ScrollReveal>
  </section>

  <!-- Project modal -->
  <Modal id="project-modal" />

  <!-- Lightbox -->
  <LightboxModal />

  <script>
    import { openModal, closeModal } from '../scripts/modal';
    import { renderProjectModalHtml } from '../scripts/project-modal';
    import { openLightbox } from '../scripts/lightbox';
    import '../scripts/search';

    const projectData = {
      projects: (await import('../data/projects')).projects,
      statusConfig: (await import('../data/projects')).statusConfig,
    };

    // Project card click -> open modal
    document.querySelectorAll('.project-card').forEach((card) => {
      card.addEventListener('click', () => {
        const id = Number((card as HTMLElement).dataset.projectId);
        const project = projectData.projects.find((p) => p.id === id);
        if (!project) return;

        const status = projectData.statusConfig[project.status];
        const html = renderProjectModalHtml(project, status);
        openModal('project-modal', html);

        // Attach close handler to modal close button
        document.querySelector('#project-modal .modal-close-btn')?.addEventListener('click', () => {
          closeModal('project-modal');
        });

        // Attach lightbox triggers for screenshots
        document.querySelectorAll('#project-modal .lightbox-trigger').forEach((img, i) => {
          img.addEventListener('click', () => {
            const srcs = project.screenshots.map((s, idx) => ({
              src: s,
              alt: `${project.name} screenshot ${idx + 1}`,
            }));
            openLightbox(srcs, i);
          });
        });
      });
    });
  </script>
</Layout>
