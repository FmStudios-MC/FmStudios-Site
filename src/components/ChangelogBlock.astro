---
import Icon from './Icon.astro';
import type { ChangelogEntry } from '../data/changelog';

interface Props {
  projectName: string;
  entries: ChangelogEntry[];
}

const { projectName, entries } = Astro.props;
const safeId = projectName.replace(/\s+/g, '-').replace(/[{}]/g, '');
---

<div class="card overflow-hidden">
  <button
    class="changelog-toggle w-full p-5 text-left flex justify-between items-center hover:bg-[var(--bg-card-hover)] transition-colors"
    data-target={`changelog-${safeId}`}
  >
    <div>
      <h3 class="text-lg font-bold" style="color: var(--text-primary);">{projectName}</h3>
      <p class="text-xs mt-1" style="color: var(--text-dim);">
        {entries.length} version{entries.length > 1 ? 's' : ''} &middot; Click to expand
      </p>
    </div>
    <Icon name="chevron-down" size={20} class="transition-transform flex-shrink-0" />
  </button>

  <div id={`changelog-${safeId}`} class="hidden border-t border-[var(--border-card)]">
    {entries.map((entry, index) => (
      <div class:list={['p-5', index < entries.length - 1 && 'border-b border-[var(--border-card)]']}>
        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start mb-4 gap-2">
          <div>
            <h4 class="text-base font-bold" style="color: var(--text-primary);">Version {entry.version}</h4>
            <span class="text-xs flex items-center gap-1 mt-1" style="color: var(--text-dim);">
              <Icon name="calendar" size={12} /> {entry.date}
            </span>
          </div>
          <span class="text-xs font-semibold px-2 py-0.5 self-start" style="background-color: var(--accent); color: #fff;">
            {entry.changes.length} change{entry.changes.length > 1 ? 's' : ''}
          </span>
        </div>
        <ul class="space-y-2">
          {entry.changes.map((change) => (
            <li class="flex items-start gap-2 text-sm p-2 hover:bg-[var(--bg-card-hover)] transition-colors" style="color: var(--text-muted);">
              <Icon name="check" size={14} class="flex-shrink-0 mt-0.5" style="color: var(--accent);" />
              <span>{change}</span>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </div>
</div>
